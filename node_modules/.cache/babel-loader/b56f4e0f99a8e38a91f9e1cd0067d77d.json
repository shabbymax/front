{"ast":null,"code":"import _toConsumableArray from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from'react';import{Link,useNavigate}from'react-router-dom';import{toast}from'react-toastify';import bookApi from'../../../api/bookApi';import{useAppSelector}from'../../../store';import{routePath}from'../../../constants';import CommonButton from'../CommonButton';import Rating from'../Rating';import BooksWrapper from'./Books.styles';import favoriteUnchoosenIcon from'../../images/fav-unchoosen.png';import favoriteChoosenIcon from'../../images/favorites.png';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var BooksRender=function BooksRender(props){var navigate=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),favoritesIds=_useState2[0],setFavoritesIds=_useState2[1];var user=useAppSelector(function(state){return state.userReducer.user;});useEffect(function(){var updatedFavoritesIds=[];props.booksArray.forEach(function(book){if(book.isInFavorite){updatedFavoritesIds.push(book.bookId);}});setFavoritesIds(updatedFavoritesIds);},[props.booksArray]);var handleClickOnFavorite=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(bookId){var indexInFavorites;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(user){_context.next=3;break;}return _context.abrupt(\"return\",navigate(routePath.signIn));case 3:indexInFavorites=favoritesIds.indexOf(bookId);if(!(indexInFavorites!==-1)){_context.next=11;break;}_context.next=7;return bookApi.removeFromFavorite({bookId:bookId});case 7:setFavoritesIds(function(favorites){return favorites.filter(function(id){return id!==bookId;});});if(props.handleFavorites){props.handleFavorites(bookId);}_context.next=14;break;case 11:_context.next=13;return bookApi.addToFavorite({bookId:bookId});case 13:setFavoritesIds([].concat(_toConsumableArray(favoritesIds),[bookId]));case 14:_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](0);toast.error('Sorry, changing favorites is not available now',{autoClose:3000});case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,16]]);}));return function handleClickOnFavorite(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(BooksWrapper,{wrap:props.wrap,children:props.booksArray.map(function(book){return/*#__PURE__*/_jsxs(\"div\",{className:\"book\",children:[/*#__PURE__*/_jsxs(Link,{className:\"book__link\",to:{pathname:routePath.createProductURL(book.bookId.toString())},children:[/*#__PURE__*/_jsx(\"img\",{src:book.cover,className:\"book__cover\"}),/*#__PURE__*/_jsx(\"p\",{className:\"book__title\",children:book.title})]}),favoritesIds.includes(book.bookId)?/*#__PURE__*/_jsx(\"img\",{className:\"book__favorite\",src:favoriteChoosenIcon,onClick:function onClick(){return handleClickOnFavorite(book.bookId);}}):/*#__PURE__*/_jsx(\"img\",{className:\"book__favorite\",src:favoriteUnchoosenIcon,onClick:function onClick(){return handleClickOnFavorite(book.bookId);}}),/*#__PURE__*/_jsx(\"p\",{className:\"book__author\",children:book.author}),/*#__PURE__*/_jsxs(\"div\",{className:\"book__rating\",children:[/*#__PURE__*/_jsx(Rating,{rate:book.averageRate,isChangeRating:false,bookId:book.bookId}),/*#__PURE__*/_jsx(\"div\",{className:\"book__average-rating\",children:book.averageRate})]}),/*#__PURE__*/_jsx(CommonButton,{size:\"container\",text:\"$\".concat(book.price,\" USD\")})]},book.bookId);})});};export default BooksRender;","map":{"version":3,"names":["React","useEffect","useState","Link","useNavigate","toast","bookApi","useAppSelector","routePath","CommonButton","Rating","BooksWrapper","favoriteUnchoosenIcon","favoriteChoosenIcon","BooksRender","props","navigate","favoritesIds","setFavoritesIds","user","state","userReducer","updatedFavoritesIds","booksArray","forEach","book","isInFavorite","push","bookId","handleClickOnFavorite","signIn","indexInFavorites","indexOf","removeFromFavorite","favorites","filter","id","handleFavorites","addToFavorite","error","autoClose","wrap","map","pathname","createProductURL","toString","cover","title","includes","author","averageRate","price"],"sources":["/home/fusion/workspace/frontend/src/ui/components/Book/BooksRender.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\n\nimport bookApi from '../../../api/bookApi';\nimport { useAppSelector } from '../../../store';\nimport { routePath } from '../../../constants';\nimport { BooksArray, BookType } from '../../../types';\n\nimport CommonButton from '../CommonButton';\nimport Rating from '../Rating';\nimport BooksWrapper from './Books.styles';\n\nimport favoriteUnchoosenIcon from '../../images/fav-unchoosen.png';\nimport favoriteChoosenIcon from '../../images/favorites.png';\n\ntype BookProps = {\n  booksArray: BooksArray;\n  wrap: 'wrap' | 'nowrap';\n  handleFavorites?: (id: number) => void;\n}\n\nconst BooksRender: React.FC<BookProps> = (props) => {\n  const navigate = useNavigate();\n  const [favoritesIds, setFavoritesIds] = useState<number[]>([]);\n  const user = useAppSelector((state) => state.userReducer.user);\n\n  useEffect(() => {\n    const updatedFavoritesIds: number[] = [];\n    props.booksArray.forEach((book) => {\n      if (book.isInFavorite) {\n        updatedFavoritesIds.push(book.bookId);\n      }\n    });\n    setFavoritesIds(updatedFavoritesIds);\n  }, [props.booksArray]);\n\n  const handleClickOnFavorite = async (bookId: number) => {\n    try {\n      if (!user) {\n        return navigate(routePath.signIn);\n      }\n      const indexInFavorites = favoritesIds.indexOf(bookId);\n      if (indexInFavorites !== -1) {\n        await bookApi.removeFromFavorite({ bookId });\n        setFavoritesIds((favorites) => favorites.filter((id) => {\n          return id !== bookId;\n        }));\n        if (props.handleFavorites) {\n          props.handleFavorites(bookId);\n        }\n      } else {\n        await bookApi.addToFavorite({ bookId });\n        setFavoritesIds([...favoritesIds, bookId]);\n      }\n    } catch (err) {\n      toast.error('Sorry, changing favorites is not available now', { autoClose: 3000 });\n    }\n  };\n\n  return (\n    <BooksWrapper\n      wrap={props.wrap}\n    >\n      {props.booksArray.map((book: BookType) => {\n        return (\n          <div\n            className=\"book\"\n            key={book.bookId}\n          >\n            <Link\n              className=\"book__link\"\n              to={{ pathname: routePath.createProductURL(book.bookId.toString()) }}>\n              <img\n                src={book.cover}\n                className=\"book__cover\"\n              />\n              <p className=\"book__title\">\n                {book.title}\n              </p>\n            </Link>\n            {favoritesIds.includes(book.bookId)\n              ? (<img\n                className=\"book__favorite\"\n                src={favoriteChoosenIcon}\n                onClick={() => handleClickOnFavorite(book.bookId)}\n              />)\n              : (<img\n                className=\"book__favorite\"\n                src={favoriteUnchoosenIcon}\n                onClick={() => handleClickOnFavorite(book.bookId)}\n              />)\n            }\n            <p className=\"book__author\">\n              {book.author}\n            </p>\n            <div className=\"book__rating\">\n              <Rating\n                rate={book.averageRate}\n                isChangeRating={false}\n                bookId={book.bookId}\n              />\n              <div className=\"book__average-rating\">\n                {book.averageRate}\n              </div>\n            </div>\n            <CommonButton\n              size=\"container\"\n              text={`$${book.price} USD`}\n            />\n          </div>\n        );\n      })}\n    </BooksWrapper>\n  );\n};\n\nexport default BooksRender;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}