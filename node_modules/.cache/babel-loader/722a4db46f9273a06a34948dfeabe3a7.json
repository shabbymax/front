{"ast":null,"code":"import _asyncToGenerator from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/fusion/workspace/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{Rating as RatingStars}from'react-simple-star-rating';import{useAppSelector}from'../../../store';import bookApi from'../../../api/bookApi';import{routePath}from'../../../constants';import RatingWrapper from'./Rating.styles';import emptyStarIcon from'../../images/star.png';import filledStarIcon from'../../images/star-filled.png';import{jsx as _jsx}from\"react/jsx-runtime\";var Rating=function Rating(props){var navigate=useNavigate();var user=useAppSelector(function(state){return state.userReducer.user;});var _useState=useState(props.rate),_useState2=_slicedToArray(_useState,2),rating=_useState2[0],setRating=_useState2[1];useEffect(function(){if(props.isChangeRating){setRating(0);}},[props.isChangeRating]);var updateRating=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(newRate){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(user){_context.next=3;break;}return _context.abrupt(\"return\",navigate(routePath.signIn));case 3:_context.next=5;return bookApi.setRating({bookId:props.bookId,rating:newRate});case 5:_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);toast.error('Sorry, setting rating is not available now',{autoClose:3000});case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function updateRating(_x){return _ref.apply(this,arguments);};}();var handleRating=function handleRating(rate){setRating(rate/20);if(!props.handleChangeRating){return;}props.handleChangeRating();updateRating(rate/20);};return/*#__PURE__*/_jsx(RatingWrapper,{children:/*#__PURE__*/_jsx(RatingStars,{onClick:handleRating,ratingValue:rating*20,allowHalfIcon:false,readonly:!props.isChangeRating,fullIcon:/*#__PURE__*/_jsx(\"img\",{src:filledStarIcon,className:\"rating__star\"}),emptyIcon:/*#__PURE__*/_jsx(\"img\",{src:emptyStarIcon,className:\"rating__star\"})})});};export default Rating;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","toast","Rating","RatingStars","useAppSelector","bookApi","routePath","RatingWrapper","emptyStarIcon","filledStarIcon","props","navigate","user","state","userReducer","rate","rating","setRating","isChangeRating","updateRating","newRate","signIn","bookId","error","autoClose","handleRating","handleChangeRating"],"sources":["/home/fusion/workspace/frontend/src/ui/components/Rating/Rating.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { toast } from 'react-toastify';\nimport { Rating as RatingStars } from 'react-simple-star-rating';\n\nimport { useAppSelector } from '../../../store';\nimport bookApi from '../../../api/bookApi';\nimport { routePath } from '../../../constants';\n\nimport RatingWrapper from './Rating.styles';\n\nimport emptyStarIcon from '../../images/star.png';\nimport filledStarIcon from '../../images/star-filled.png';\n\ntype RatingProps = {\n  bookId: number,\n  rate: number | 0,\n  isChangeRating: boolean,\n  handleChangeRating?: () => void,\n}\n\nconst Rating: React.FC<RatingProps> = (props) => {\n  const navigate = useNavigate();\n  const user = useAppSelector((state) => state.userReducer.user);\n  const [rating, setRating] = useState(props.rate);\n\n  useEffect(() => {\n    if (props.isChangeRating) {\n      setRating(0);\n    }\n  }, [props.isChangeRating]);\n\n  const updateRating = async (newRate: number) => {\n    try {\n      if (!user) {\n        return navigate(routePath.signIn);\n      }\n      await bookApi.setRating({\n        bookId: props.bookId,\n        rating: newRate,\n      });\n    } catch (err) {\n      toast.error('Sorry, setting rating is not available now', { autoClose: 3000 });\n    }\n  };\n\n  const handleRating = (rate: number) => {\n    setRating(rate / 20);\n    if (!props.handleChangeRating) {\n      return;\n    }\n\n    props.handleChangeRating();\n    updateRating(rate / 20);\n  };\n\n  return (\n    <RatingWrapper>\n      <RatingStars\n        onClick={handleRating}\n        ratingValue={rating * 20}\n        allowHalfIcon={false}\n        readonly={!props.isChangeRating}\n        fullIcon={(\n          <img\n            src={filledStarIcon}\n            className=\"rating__star\"\n          />\n        )}\n        emptyIcon={(\n          <img\n            src={emptyStarIcon}\n            className=\"rating__star\"\n          />\n        )}\n      />\n    </RatingWrapper>\n  );\n};\n\nexport default Rating;\n"],"mappings":"kWAAA,MAAOA,MAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,WAAT,KAA4B,kBAA5B,CAEA,OAASC,KAAT,KAAsB,gBAAtB,CACA,OAASC,MAAM,GAAIC,YAAnB,KAAsC,0BAAtC,CAEA,OAASC,cAAT,KAA+B,gBAA/B,CACA,MAAOC,QAAP,KAAoB,sBAApB,CACA,OAASC,SAAT,KAA0B,oBAA1B,CAEA,MAAOC,cAAP,KAA0B,iBAA1B,CAEA,MAAOC,cAAP,KAA0B,uBAA1B,CACA,MAAOC,eAAP,KAA2B,8BAA3B,C,2CASA,GAAMP,OAA6B,CAAG,QAAhCA,OAAgC,CAACQ,KAAD,CAAW,CAC/C,GAAMC,SAAQ,CAAGX,WAAW,EAA5B,CACA,GAAMY,KAAI,CAAGR,cAAc,CAAC,SAACS,KAAD,QAAWA,MAAK,CAACC,WAAN,CAAkBF,IAA7B,EAAD,CAA3B,CACA,cAA4Bb,QAAQ,CAACW,KAAK,CAACK,IAAP,CAApC,wCAAOC,MAAP,eAAeC,SAAf,eAEAnB,SAAS,CAAC,UAAM,CACd,GAAIY,KAAK,CAACQ,cAAV,CAA0B,CACxBD,SAAS,CAAC,CAAD,CAAT,CACD,CACF,CAJQ,CAIN,CAACP,KAAK,CAACQ,cAAP,CAJM,CAAT,CAMA,GAAMC,aAAY,0FAAG,iBAAOC,OAAP,qIAEZR,IAFY,yDAGRD,QAAQ,CAACL,SAAS,CAACe,MAAX,CAHA,+BAKXhB,QAAO,CAACY,SAAR,CAAkB,CACtBK,MAAM,CAAEZ,KAAK,CAACY,MADQ,CAEtBN,MAAM,CAAEI,OAFc,CAAlB,CALW,uFAUjBnB,KAAK,CAACsB,KAAN,CAAY,4CAAZ,CAA0D,CAAEC,SAAS,CAAE,IAAb,CAA1D,EAViB,oEAAH,kBAAZL,aAAY,4CAAlB,CAcA,GAAMM,aAAY,CAAG,QAAfA,aAAe,CAACV,IAAD,CAAkB,CACrCE,SAAS,CAACF,IAAI,CAAG,EAAR,CAAT,CACA,GAAI,CAACL,KAAK,CAACgB,kBAAX,CAA+B,CAC7B,OACD,CAEDhB,KAAK,CAACgB,kBAAN,GACAP,YAAY,CAACJ,IAAI,CAAG,EAAR,CAAZ,CACD,CARD,CAUA,mBACE,KAAC,aAAD,wBACE,KAAC,WAAD,EACE,OAAO,CAAEU,YADX,CAEE,WAAW,CAAET,MAAM,CAAG,EAFxB,CAGE,aAAa,CAAE,KAHjB,CAIE,QAAQ,CAAE,CAACN,KAAK,CAACQ,cAJnB,CAKE,QAAQ,cACN,YACE,GAAG,CAAET,cADP,CAEE,SAAS,CAAC,cAFZ,EANJ,CAWE,SAAS,cACP,YACE,GAAG,CAAED,aADP,CAEE,SAAS,CAAC,cAFZ,EAZJ,EADF,EADF,CAsBD,CAzDD,CA2DA,cAAeN,OAAf"},"metadata":{},"sourceType":"module"}